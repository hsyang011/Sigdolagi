<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edu.springboot.community.IPhotoboardService">
	
	
	
	<!-- list  -->
	<select id="photoGetTotalCount" resultType="int" parameterType="com.edu.springboot.community.ParameterDTO">
    SELECT COUNT(*) FROM PHOTOBOARD
    <if test="searchKeyword != null and !searchKeyword.equals('')">
        WHERE ${searchField} LIKE '%' || #{searchKeyword} || '%'
    </if>
	</select>
	
	
		
	
	<select id="PhotoListPage"
		resultType="com.edu.springboot.community.PhotoBoardDTO"
		parameterType="com.edu.springboot.community.ParameterDTO">
		SELECT * FROM (
			SELECT Tb.*, rownum rNum FROM(
				SELECT * FROM photoboard
				<if test="searchKeyword!=null and !searchKeyword.equals('')">
				WHERE ${searchField} LIKE '%'||#{searchKeyword} ||'%'
				</if>
				ORDER BY photoboard_idx DESC
			) Tb
		)
	 	WHERE rNum<![CDATA[>=]]>#{start} AND rNum<![CDATA[<=]]>#{end}
	</select>
	
	<select id="photoview" resultType="com.edu.springboot.community.PhotoBoardDTO" parameterType="com.edu.springboot.community.PhotoBoardDTO">
		SELECT * FROM photoboard WHERE photoboard_idx=${photoboard_idx}
	</select>
	
	<!-- <update id="photoedit" parameterType="com.edu.springboot.community.PhotoBoardDTO">
		UPDATE photoboard SET title=#{title}, sfile=#{sfile} content=#{content} WHERE photoboard_idx=${photoboard_idx}
	</update> -->
	<update id="photoedit" parameterType="com.edu.springboot.community.PhotoBoardDTO">
	    UPDATE photoboard SET title = #{title}, content = #{content}, ofile=#{ofile}, sfile = #{sfile} 
	    WHERE photoboard_idx = #{photoboard_idx}
	</update>
	
	
	<delete id="photodelete">
		DELETE FROM photoboard WHERE photoboard_idx=#{photoboard_idx}
	</delete>
	
	
	<insert id="writeConmments" >
	   INSERT INTO  COMMENTS (comments_idx, nickname, content ,postdate, photoboard_idx )
	   VALUES (seq_comments_idx.nextval,  #{nickname}, #{content} , sysdate , #{photoboard_idx} )
	</insert>
	
	
	<!--코멘트 테이블 가져오기  -->
	<select id="CommentsPage"
       resultType="com.edu.springboot.community.CommentsDTO"
       parameterType="com.edu.springboot.community.CommentsDTO">
  		 SELECT * FROM COMMENTS WHERE photoboard_idx = #{photoboard_idx}
	
	</select>
	
	

	
	
	
	

		
</mapper>